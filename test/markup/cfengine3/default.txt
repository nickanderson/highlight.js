body common control
{
  inputs => { "$(sys.libdir)/stdlib.cf" };
  bundlesequence => { "cfengine:main" };
}

bundle agent example
{
  reports:
    "Some example promise";
}

body file control
{
  namespace => "cfengine"
}

bundle agent example( param1, param2, param3 )
{
@if minimum_version(3.10)
  reports: "Running CFEngine 3.10 or higher";
@endif

@if maximum_version(3.12.1)
  reports: "Running CFEngine 3.12.1 or lower";
@endif

@if at_version(3.10.1)
  reports: "Running CFEngine 3.10.1";
@endif

@if between_versions( 3.10.1, 3.12.0 )
  reports: "Between CFEngine 3.10.1 and 3.12.0";
@endif

@if after_version( 3.15.1 )
  reports: "After CFEngine 3.15.1";
@endif

@if minimum_version(3.16)
  # Implementation for 3.16+
  vars:
    "container"
      data => classfiltercsv(...);
@else
  # Implementation for versions before 3.16
  vars:
    "container"
      data => readcsv(...);
@endif
}

bundle server shared
# @brief share files
{
  access:
    "/srv/public"
      admit => { "0.0.0.0/0" };
}

bundle agent main
# @brief Main driver
{
  vars:
    "mystring" string => "mystringvalue";
    "d" data => '{ "my": "json" }';
    "l" slist => { "my", "string", "list" };

  methods:
    "Example" usebundle => cfengine:example( "one", "$(mystring)", $(mystring) );
}
